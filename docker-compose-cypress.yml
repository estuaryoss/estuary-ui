version: '3'
services:
  ui:
    build: .
    environment:
      - NODE_ENV=development #production
      - SERVICE_BACKEND_URL=http://localhost:4000 #the machine where the backend is deployed. can be the same machine
      - SERVICE_USERNAME=doesNotMatterBecauseTheBackendServiceIsMocked
      - SERVICE_PASSWORD=doesNotMatterBecauseTheBackendServiceIsMocked
    #    volumes:
    #      - ./:/home/node/app
    expose:
      - "8080"
    ports:
      - "8080:8080"

  # this container will run Cypress test using built-in Electron browser
  e2e-electron:
    image: "cypress/included:9.1.0"
    depends_on:
      - ui
    # mount the host directory cypress and the file cypress.json as
    # volumes within the container "e2e" container
    #
    # this means that:
    #  1. anything that Cypress writes to these folders (e.g., screenshots,
    #     videos) appears also on the Docker host's filesystem
    #  2. any change that the developer applies to Cypress files on the host
    #     machine immediately takes effect within the e2e container (no docker
    #     rebuild required).
    environment:
      - CYPRESS_baseUrl=http://ui:8080
    volumes:
      - ./cypress:/cypress
      - ./cypress.json:/cypress.json

  # this container will run Cypress test using Chrome browser
  e2e-chrome:
    image: "cypress/included:9.1.0"
    # container_name: cypress
    # "cypress/included" images have entrypoint set to globally installed cypress
    # so the command can simply add any arguments
    command: "--browser chrome"
    volumes:
      - ./cypress:/cypress
      - ./cypress.json:/cypress.json

  # this container will run Cypress test using Firefox browser
  # note that both Chrome and Firefox browsers were pre-installed in the Docker image
  e2e-firefox:
    image: "cypress/included:9.1.0"
    command: "--browser firefox --config video=false"
    # if you want to debug FF run, pass DEBUG variable like
    environment:
      - DEBUG=cypress:server:browsers:firefox-util,cypress:server:util:process_profiler
    volumes:
      - ./cypress:/cypress
      - ./cypress.json:/cypress.json
